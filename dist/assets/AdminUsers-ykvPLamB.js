import{b as $,r,j as s,f as m}from"./main-DSTn5bYd.js";import{N as S}from"./NebulaLoader-CU5h7_r9.js";import{g as _}from"./color-DkCkRny3.js";function R(){const{user:t}=$(),[N,u]=r.useState([]),[U,w]=r.useState(!0),[x,f]=r.useState(""),[A,p]=r.useState(!1),[d,h]=r.useState({fullName:"",password:"",is_admin:!1}),[l,c]=r.useState(null),[a,b]=r.useState({fullName:"",password:"",is_admin:!1}),[y,g]=r.useState(""),j=async()=>{w(!0);try{const e=await m.get("/admin/users");if(!e.ok)throw new Error("Failed to load users");u(await e.json())}catch(e){f(e.message||"Failed to load users")}finally{w(!1)}};r.useEffect(()=>{j()},[]);const E=async()=>{f("");try{const e={fullName:d.fullName,password:d.password,is_admin:!!d.is_admin},i=await m.post("/auth/register",e);if(!i.ok){const n=await i.text();throw new Error(n||"Failed to create user")}p(!1),h({fullName:"",password:"",is_admin:!1}),await j()}catch(e){f(e.message||"Failed to create user")}},v=e=>{c(e),b({fullName:e.username,password:"",is_admin:!!e.is_admin}),g("")},F=async()=>{if(l){g("");try{const e={};if(a.fullName.trim()!==l.username&&(e.fullName=a.fullName.trim()),a.password.trim()&&(e.password=a.password.trim()),a.is_admin!==l.is_admin&&(e.is_admin=a.is_admin),Object.keys(e).length===0){c(null);return}const i=await m.put(`/admin/users/${l.id}`,e);if(!i.ok){const n=await i.text();throw new Error(n||"Failed to update user")}c(null),await j()}catch(e){g(e.message||"Failed to update user")}}},k=async e=>{if(e.id!==(t==null?void 0:t.id))try{(await m.put(`/admin/users/${e.id}`,{is_admin:!e.is_admin})).ok&&u(n=>n.map(o=>o.id===e.id?{...o,is_admin:!e.is_admin}:o))}catch{}},C=async e=>{if(e.id!==(t==null?void 0:t.id)&&window.confirm(`Delete user ${e.username}?`))try{(await m.delete(`/admin/users/${e.id}`)).ok&&u(n=>n.filter(o=>o.id!==e.id))}catch{}};return t!=null&&t.isAdmin?U?s.jsx("div",{className:"h-full w-full flex items-center justify-center bg-black",children:s.jsx(S,{size:96})}):s.jsxs("div",{className:"h-full w-full bg-black text-gray-100 p-4 md:p-6 overflow-hidden",children:[s.jsxs("div",{className:"max-w-5xl mx-auto",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"User Management"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Manage team members and their permissions"})]}),s.jsx("button",{onClick:()=>p(!0),className:"px-4 py-2 rounded-md bg-sca-purple text-white hover:bg-sca-purple/80",children:"Add User"})]}),x&&s.jsx("div",{className:"mb-4 bg-red-500/20 text-red-200 border border-red-500/40 rounded p-3",children:x}),s.jsxs("div",{className:"hidden md:block bg-black border border-white/10 rounded-lg overflow-hidden",children:[s.jsx("div",{className:"px-6 py-3 border-b border-white/10",children:"All Users"}),s.jsxs("table",{className:"min-w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left text-xs uppercase text-gray-400",children:[s.jsx("th",{className:"px-6 py-3",children:"User"}),s.jsx("th",{className:"px-6 py-3",children:"Role"}),s.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-white/10",children:N.map(e=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",style:{backgroundColor:e.avatar_color||_(e.username,null)},children:e.username.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2)}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.username}),s.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",e.id]})]})]})}),s.jsx("td",{className:"px-6 py-3",children:s.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${e.is_admin?"bg-purple-500/25 text-purple-400":"bg-green-500/20 text-green-400"}`,children:e.is_admin?"Admin":"User"})}),s.jsx("td",{className:"px-6 py-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-3 text-sm",children:[s.jsx("button",{onClick:()=>v(e),className:"text-indigo-400 hover:text-indigo-300",children:"Edit"}),s.jsx("button",{onClick:()=>k(e),disabled:e.id===(t==null?void 0:t.id),className:`text-blue-400 hover:text-blue-300 ${e.id===(t==null?void 0:t.id)?"opacity-50 cursor-not-allowed":""}`,children:e.is_admin?"Remove Admin":"Make Admin"}),s.jsx("button",{onClick:()=>C(e),disabled:e.id===(t==null?void 0:t.id),className:`text-red-400 hover:text-red-300 ${e.id===(t==null?void 0:t.id)?"opacity-50 cursor-not-allowed":""}`,children:"Delete"})]})})]},e.id))})]})]}),s.jsx("div",{className:"md:hidden space-y-3 overflow-y-auto pb-24",children:N.map(e=>s.jsxs("div",{className:"border border-white/10 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",style:{backgroundColor:e.avatar_color||_(e.username,null)},children:e.username.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2)}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.username}),s.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",e.id]})]})]}),s.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${e.is_admin?"bg-purple-500/25 text-purple-400":"bg-green-500/20 text-green-400"}`,children:e.is_admin?"Admin":"User"})]}),s.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[s.jsx("button",{onClick:()=>v(e),className:"px-3 py-2 rounded bg-white/5",children:"Edit"}),s.jsxs("button",{onClick:()=>k(e),disabled:e.id===(t==null?void 0:t.id),className:`px-3 py-2 rounded ${e.id===(t==null?void 0:t.id)?"bg-white/5 text-gray-500":"bg-blue-900/40 text-blue-300"}`,children:[e.is_admin?"Remove":"Make"," Admin"]}),s.jsx("button",{onClick:()=>C(e),disabled:e.id===(t==null?void 0:t.id),className:`px-3 py-2 rounded ${e.id===(t==null?void 0:t.id)?"bg-white/5 text-gray-500":"bg-red-900/40 text-red-300"}`,children:"Delete"})]})]},e.id))})]}),A&&s.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>p(!1),children:s.jsxs("div",{className:"bg-gray-900 border border-white/10 rounded-lg p-5 w-full max-w-md",onClick:e=>e.stopPropagation(),children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Add New User"}),x&&s.jsx("div",{className:"mb-2 bg-red-500/20 text-red-200 border border-red-500/40 rounded p-2",children:x}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("input",{value:d.fullName,onChange:e=>h({...d,fullName:e.target.value}),placeholder:"Full name",className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"}),s.jsx("input",{value:d.password,onChange:e=>h({...d,password:e.target.value}),placeholder:"Password",type:"password",className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:d.is_admin,onChange:e=>h({...d,is_admin:e.target.checked})}),s.jsx("span",{children:"Admin"})]})]}),s.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 rounded bg-white/10",children:"Cancel"}),s.jsx("button",{onClick:E,className:"px-4 py-2 rounded bg-sca-purple",children:"Create"})]})]})}),l&&s.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>c(null),children:s.jsxs("div",{className:"bg-gray-900 border border-white/10 rounded-lg p-5 w-full max-w-md",onClick:e=>e.stopPropagation(),children:[s.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["Edit User: ",l.username]}),y&&s.jsx("div",{className:"mb-2 bg-red-500/20 text-red-200 border border-red-500/40 rounded p-2",children:y}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-400",children:"Full name"}),s.jsx("input",{value:a.fullName,onChange:e=>b({...a,fullName:e.target.value}),className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-400",children:"New password (optional)"}),s.jsx("input",{value:a.password,onChange:e=>b({...a,password:e.target.value}),type:"password",className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"})]}),s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:a.is_admin,onChange:e=>b({...a,is_admin:e.target.checked}),disabled:l.id===(t==null?void 0:t.id)}),s.jsxs("span",{children:["Admin ",l.id===(t==null?void 0:t.id)?"(cannot modify own status)":""]})]})]}),s.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 rounded bg-white/10",children:"Cancel"}),s.jsx("button",{onClick:F,className:"px-4 py-2 rounded bg-sca-purple",children:"Update"})]})]})})]}):s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-2",children:"Access Denied"}),s.jsx("p",{className:"text-gray-400",children:"You don't have permission to access this page."})]})})}export{R as default};
