import{b as D,r as a,f as i,j as e}from"./main-CQR3AAOS.js";import{N as F}from"./NebulaLoader-DlUZrUK8.js";import{g as $}from"./color-DkCkRny3.js";function G(){const{updateUser:b}=D(),[t,f]=a.useState(null),[_,w]=a.useState(!0),[j,m]=a.useState(!1),[o,x]=a.useState(""),[y,u]=a.useState(""),[v,n]=a.useState(""),[N,k]=a.useState(""),[d,C]=a.useState(""),[P,h]=a.useState(!1),[p,c]=a.useState(null),S=a.useRef(null),[T,U]=a.useState(""),l=a.useRef(null),A=T||(t==null?void 0:t.avatar_color)||$((t==null?void 0:t.username)||"");a.useEffect(()=>(E(),()=>{l.current&&clearTimeout(l.current)}),[]);async function E(){w(!0);try{const s=await i.get("/profile");if(s.ok){const r=await s.json();f(r),C(r.username||"")}}catch(s){console.error("Failed to load profile",s)}finally{w(!1)}}async function I(s){try{(await i.put("/profile",{avatar_color:s})).ok&&(f(g=>g&&{...g,avatar_color:s}),U(""),b({avatarColor:s}))}catch(r){console.error("Failed to update avatar color",r)}}function L(s){U(s),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>I(s),500)}async function M(){if(c(null),d===(t==null?void 0:t.username)){h(!1);return}try{const s=await i.put("/profile",{username:d});if(s.ok)c({type:"success",text:"Username updated successfully!"}),E(),b({name:d});else{const r=await s.json().catch(()=>({}));c({type:"error",text:r.error||"Failed to update username."})}}catch{c({type:"error",text:"Network error or server unreachable."})}finally{h(!1),setTimeout(()=>c(null),5e3)}}async function R(){if(o!==y){n("Passwords do not match");return}if(o.length<6){n("Password must be at least 6 characters long");return}try{n("");const s=await i.put("/profile",{password:o});if(s.ok)k("Password updated successfully"),x(""),u(""),m(!1),setTimeout(()=>k(""),3e3);else{const r=await s.json().catch(()=>({}));n(r.error||"Failed to update password")}}catch(s){n("Error updating password"),console.error("Error updating password",s)}}return _?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(F,{size:96})}):e.jsx("div",{className:"flex-1 overflow-y-auto bg-black text-gray-100",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Profile"}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Manage your account settings and preferences"})]}),e.jsxs("div",{className:"bg-black border border-gray-700 rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-white",children:"Account Information"})}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"flex items-center space-x-6 mb-6",children:[e.jsxs("div",{className:"flex-shrink-0 relative group",children:[e.jsx("div",{className:"h-20 w-20 rounded-full flex items-center justify-center text-white font-bold text-3xl transition-opacity relative overflow-hidden cursor-pointer",style:{backgroundColor:A},title:"Click to change avatar color",onClick:()=>{var s;return(s=S.current)==null?void 0:s.click()},children:t!=null&&t.username?t.username.split(" ").map(s=>s[0]).join("").toUpperCase().substring(0,2):""}),e.jsx("input",{ref:S,type:"color",value:A,onChange:s=>L(s.target.value),className:"absolute inset-0 opacity-0 cursor-pointer","aria-label":"Avatar color"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-white",children:t==null?void 0:t.username}),e.jsx("p",{className:"text-sm text-gray-400",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t!=null&&t.is_admin?"bg-sca-purple/25 text-sca-purple":"bg-green-500/25 text-green-400"}`,children:t!=null&&t.is_admin?"Administrator":"Team Member"})}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Member since ",t!=null&&t.created_at?new Date(t.created_at).toLocaleDateString():"Unknown"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"User ID"}),e.jsx("div",{className:"mt-1 text-sm text-white",children:t==null?void 0:t.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Name"}),e.jsxs("div",{className:"mt-1 text-sm text-white flex items-center",children:[P?e.jsx("input",{type:"text",value:d,onChange:s=>C(s.target.value),className:"p-1 border border-gray-600 rounded bg-black text-gray-100 flex-grow focus:outline-none"}):e.jsx("span",{className:"font-medium text-white",children:t==null?void 0:t.username}),P?e.jsx("button",{onClick:M,className:"ml-2 px-2 py-1 text-xs font-medium text-green-400 bg-green-600/20 rounded-md hover:bg-green-600/30",children:"Save"}):e.jsx("button",{onClick:()=>h(!0),className:"ml-2 px-2 py-1 text-xs font-medium text-sca-purple bg-sca-purple/20 rounded-md hover:bg-sca-purple/30",children:"Edit"})]}),p&&e.jsx("p",{className:`mt-2 text-sm ${p.type==="success"?"text-green-400":"text-red-400"}`,children:p.text})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Role"}),e.jsx("div",{className:"mt-1 text-sm text-white",children:t!=null&&t.is_admin?"Administrator":"Team Member"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Account Created"}),e.jsx("div",{className:"mt-1 text-sm text-white",children:t!=null&&t.created_at?new Date(t.created_at).toLocaleDateString():"Unknown"})]})]}),N&&e.jsx("div",{className:"mb-4 bg-green-500/25 border border-green-600 text-green-400 px-4 py-3 rounded",children:N}),v&&e.jsx("div",{className:"mb-4 bg-red-500/25 border border-red-600 text-red-500 px-4 py-3 rounded",children:v}),e.jsxs("div",{className:"border-t border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Password"}),!j&&e.jsx("button",{onClick:()=>m(!0),className:"text-sca-purple hover:text-white text-sm font-medium",children:"Change Password"})]}),j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"New Password"}),e.jsx("input",{type:"password",value:o,onChange:s=>x(s.target.value),className:"mt-1 block w-full bg-black border-gray-600 text-gray-100 rounded-md shadow-sm focus:outline-none",placeholder:"Enter new password"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Confirm Password"}),e.jsx("input",{type:"password",value:y,onChange:s=>u(s.target.value),className:"mt-1 block w-full bg-black border-gray-600 text-gray-100 rounded-md shadow-sm focus:outline-none",placeholder:"Confirm new password"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 text-sm font-medium text-white bg-sca-purple hover:bg-sca-purple/80 rounded-md",children:"Update Password"}),e.jsx("button",{onClick:()=>{m(!1),x(""),u(""),n("")},className:"px-4 py-2 text-sm font-medium text-white bg-transparent hover:text-sca-purple rounded-md",children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"Password last changed: Not available"})]})]})]}),e.jsxs("div",{className:"mt-6 bg-black border border-gray-700 rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-white",children:"Account Actions"})}),e.jsx("div",{className:"px-6 py-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-white",children:"Logout"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Sign out of your account on this device"})]}),e.jsx("button",{onClick:()=>{localStorage.removeItem("frc7598_auth"),window.location.href="/"},className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-500 rounded-md",children:"Logout"})]})})})]})]})})}export{G as default};
