import{b as P,u as $,r as l,f as m,j as e}from"./main-Du1GMxg9.js";import{N as E}from"./NebulaLoader-CImV6PIf.js";function M(){const{user:i}=P(),j=$(),[d,p]=l.useState([]),[v,y]=l.useState(!0),[w,h]=l.useState(!1),[s,r]=l.useState(null),[n,u]=l.useState("pending"),[N,k]=l.useState([]),[a,o]=l.useState({title:"",description:"",assigned_to:"",due_date:"",priority:"medium"});l.useEffect(()=>{new URLSearchParams(j.search).get("filter")==="assigned"&&u("assigned")},[]),l.useEffect(()=>{f(),_()},[]);const f=async()=>{y(!0);try{const t=await m.get("/tasks");t.ok&&p(await t.json())}finally{y(!1)}},_=async()=>{try{if(i!=null&&i.isAdmin){const t=await m.get("/admin/users");t.ok&&k(await t.json())}}catch{}},C=async()=>{const t={...a,assigned_to:a.assigned_to?parseInt(a.assigned_to):null};(await m.post("/tasks",t)).ok&&(await f(),h(!1),o({title:"",description:"",assigned_to:"",due_date:"",priority:"medium"}))},T=async(t,g)=>{(await m.put(`/tasks/${t}`,g)).ok&&(await f(),r(null))},A=async t=>{if(!window.confirm("Delete this task?"))return;(await m.delete(`/tasks/${t}`)).ok&&p(d.filter(c=>c.id!==t))},D=async t=>{(await m.request("PATCH",`/tasks/${t.id}/complete`,{completed:!t.completed})).ok&&p(d.map(c=>c.id===t.id?{...c,completed:!c.completed}:c))},b=l.useMemo(()=>n==="completed"?d.filter(t=>t.completed):n==="assigned"?d.filter(t=>!t.completed&&t.assigned_to===(i==null?void 0:i.id)):d.filter(t=>!t.completed),[d,n,i==null?void 0:i.id]),x={total:d.length,completed:d.filter(t=>t.completed).length,pending:d.filter(t=>!t.completed).length,overdue:d.filter(t=>!t.completed&&t.due_date&&new Date(t.due_date)<new Date).length};if(v)return e.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:e.jsx(E,{size:96})});const S=t=>({high:"bg-red-500/20 text-red-300",medium:"bg-yellow-500/20 text-yellow-200",low:"bg-green-500/20 text-green-300"})[t]||"bg-gray-500/20 text-gray-300";return e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Planner"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Track and manage team tasks"})]}),e.jsx("button",{onClick:()=>h(!0),className:"px-3 py-2 text-sm font-medium text-black bg-sca-gold hover:bg-yellow-400 rounded",children:"Add Task"})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"border border-white/10 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-sca-purple rounded-md flex items-center justify-center text-sca-gold font-bold",children:x.pending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Pending"}),e.jsx("div",{className:"text-white text-lg font-medium",children:x.pending})]})]})}),e.jsx("div",{className:"border border-white/10 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-md flex items-center justify-center text-white font-bold",children:x.completed}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Completed"}),e.jsx("div",{className:"text-white text-lg font-medium",children:x.completed})]})]})}),e.jsx("div",{className:"border border-white/10 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-600 rounded-md flex items-center justify-center text-white font-bold",children:x.overdue}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Overdue"}),e.jsx("div",{className:"text-white text-lg font-medium",children:x.overdue})]})]})})]}),e.jsxs("div",{className:"px-4",children:[e.jsx("div",{className:"border border-white/10 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>u("pending"),className:`px-3 py-2 rounded text-sm ${n==="pending"?"bg-sca-purple/30 text-sca-gold":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Pending"}),e.jsx("button",{onClick:()=>u("assigned"),className:`px-3 py-2 rounded text-sm ${n==="assigned"?"bg-yellow-600/25 text-yellow-200":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Assigned to me"}),e.jsx("button",{onClick:()=>u("completed"),className:`px-3 py-2 rounded text-sm ${n==="completed"?"bg-green-600/25 text-green-300":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Completed"})]})}),e.jsxs("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-white/10",children:e.jsx("h3",{className:"text-lg font-medium",children:n==="pending"?"Pending Tasks":n==="assigned"?"Assigned to Me":"Completed Tasks"})}),e.jsx("div",{className:"divide-y divide-white/10",children:b.length>0?b.map(t=>e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:!!t.completed,onChange:()=>D(t),className:"h-4 w-4 text-sca-purple focus:ring-sca-purple border-gray-600 rounded bg-black"}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-sm font-medium ${t.completed?"text-gray-500 line-through":"text-white"}`,children:t.title}),e.jsx("p",{className:`text-sm ${t.completed?"text-gray-400":"text-gray-500"}`,children:t.description}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-4 text-xs text-gray-400",children:[e.jsxs("span",{children:["Created by: ",t.creator_username||"Unknown"]}),t.assignee_username&&e.jsxs("span",{children:["Assigned to: ",t.assignee_username]}),t.due_date&&e.jsxs("span",{className:new Date(t.due_date)<new Date&&!t.completed?"text-red-400":"",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S(t.priority)}`,children:t.priority}),((i==null?void 0:i.isAdmin)||t.created_by===(i==null?void 0:i.id))&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(t),className:"text-sca-gold hover:text-white text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>A(t.id),className:"text-red-500 hover:text-red-400 text-sm",children:"Delete"})]})]})]})},t.id)):e.jsx("div",{className:"px-6 py-8 text-center text-gray-400",children:"No tasks found"})})]})]}),(w||s)&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"relative p-6 bg-black w-full max-w-md rounded-lg border border-white/10",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:s?"Edit Task":"Add New Task"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Title"}),e.jsx("input",{type:"text",value:s?s.title:a.title,onChange:t=>s?r({...s,title:t.target.value}):o({...a,title:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Description"}),e.jsx("textarea",{rows:3,value:s?s.description:a.description,onChange:t=>s?r({...s,description:t.target.value}):o({...a,description:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Priority"}),e.jsxs("select",{value:s?s.priority:a.priority,onChange:t=>s?r({...s,priority:t.target.value}):o({...a,priority:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Due Date"}),e.jsx("input",{type:"date",value:s?s.due_date||"":a.due_date,onChange:t=>s?r({...s,due_date:t.target.value}):o({...a,due_date:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),(i==null?void 0:i.isAdmin)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Assign To"}),e.jsxs("select",{value:s?s.assigned_to??"":a.assigned_to,onChange:t=>s?r({...s,assigned_to:t.target.value?parseInt(t.target.value):null}):o({...a,assigned_to:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple",children:[e.jsx("option",{value:"",children:"Unassigned"}),N.map(t=>e.jsx("option",{value:t.id,children:t.username},t.id))]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{h(!1),r(null)},className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white",children:"Cancel"}),e.jsxs("button",{onClick:()=>{s?T(s.id,s):C()},className:"px-4 py-2 text-sm font-medium text-black bg-sca-gold hover:bg-yellow-400 rounded",children:[s?"Update":"Create"," Task"]})]})]})})]})}export{M as default};
