import{b as $,r as l,j as e,f as m}from"./main-BL89Q6RI.js";import{N as S}from"./NebulaLoader-zryvwZmS.js";import{g as _}from"./color-DkCkRny3.js";function R(){const{user:t}=$(),[N,b]=l.useState([]),[U,w]=l.useState(!0),[x,f]=l.useState(""),[A,p]=l.useState(!1),[d,h]=l.useState({fullName:"",password:"",is_admin:!1}),[r,c]=l.useState(null),[a,u]=l.useState({fullName:"",password:"",is_admin:!1}),[y,g]=l.useState(""),j=async()=>{w(!0);try{const s=await m.get("/admin/users");if(!s.ok)throw new Error("Failed to load users");b(await s.json())}catch(s){f(s.message||"Failed to load users")}finally{w(!1)}};l.useEffect(()=>{j()},[]);const E=async()=>{f("");try{const s={fullName:d.fullName,password:d.password,is_admin:!!d.is_admin},i=await m.post("/auth/register",s);if(!i.ok){const n=await i.text();throw new Error(n||"Failed to create user")}p(!1),h({fullName:"",password:"",is_admin:!1}),await j()}catch(s){f(s.message||"Failed to create user")}},v=s=>{c(s),u({fullName:s.username,password:"",is_admin:!!s.is_admin}),g("")},F=async()=>{if(r){g("");try{const s={};if(a.fullName.trim()!==r.username&&(s.fullName=a.fullName.trim()),a.password.trim()&&(s.password=a.password.trim()),a.is_admin!==r.is_admin&&(s.is_admin=a.is_admin),Object.keys(s).length===0){c(null);return}const i=await m.put(`/admin/users/${r.id}`,s);if(!i.ok){const n=await i.text();throw new Error(n||"Failed to update user")}c(null),await j()}catch(s){g(s.message||"Failed to update user")}}},k=async s=>{if(s.id!==(t==null?void 0:t.id))try{(await m.put(`/admin/users/${s.id}`,{is_admin:!s.is_admin})).ok&&b(n=>n.map(o=>o.id===s.id?{...o,is_admin:!s.is_admin}:o))}catch{}},C=async s=>{if(s.id!==(t==null?void 0:t.id)&&window.confirm(`Delete user ${s.username}?`))try{(await m.delete(`/admin/users/${s.id}`)).ok&&b(n=>n.filter(o=>o.id!==s.id))}catch{}};return t!=null&&t.isAdmin?U?e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-black",children:e.jsx(S,{size:96})}):e.jsxs("div",{className:"h-full w-full bg-black text-gray-100 p-4 md:p-6 overflow-hidden",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Manage team members and their permissions"})]}),e.jsx("button",{onClick:()=>p(!0),className:"px-4 py-2 rounded-md bg-sca-purple text-white hover:bg-sca-purple/80",children:"Add User"})]}),x&&e.jsx("div",{className:"mb-4 bg-red-500/20 text-red-200 border border-red-500/40 rounded p-3",children:x}),e.jsxs("div",{className:"hidden md:block bg-black border border-white/10 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-3 border-b border-white/10",children:"All Users"}),e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-xs uppercase text-gray-400",children:[e.jsx("th",{className:"px-6 py-3",children:"User"}),e.jsx("th",{className:"px-6 py-3",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",style:{backgroundColor:_(s.username,null)},children:s.username.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.username}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.id]})]})]})}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${s.is_admin?"bg-purple-500/25 text-purple-400":"bg-green-500/20 text-green-400"}`,children:s.is_admin?"Admin":"User"})}),e.jsx("td",{className:"px-6 py-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-3 text-sm",children:[e.jsx("button",{onClick:()=>v(s),className:"text-indigo-400 hover:text-indigo-300",children:"Edit"}),e.jsx("button",{onClick:()=>k(s),disabled:s.id===(t==null?void 0:t.id),className:`text-blue-400 hover:text-blue-300 ${s.id===(t==null?void 0:t.id)?"opacity-50 cursor-not-allowed":""}`,children:s.is_admin?"Remove Admin":"Make Admin"}),e.jsx("button",{onClick:()=>C(s),disabled:s.id===(t==null?void 0:t.id),className:`text-red-400 hover:text-red-300 ${s.id===(t==null?void 0:t.id)?"opacity-50 cursor-not-allowed":""}`,children:"Delete"})]})})]},s.id))})]})]}),e.jsx("div",{className:"md:hidden space-y-3 overflow-y-auto pb-24",children:N.map(s=>e.jsxs("div",{className:"border border-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",style:{backgroundColor:_(s.username,null)},children:s.username.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.username}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.id]})]})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${s.is_admin?"bg-purple-500/25 text-purple-400":"bg-green-500/20 text-green-400"}`,children:s.is_admin?"Admin":"User"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[e.jsx("button",{onClick:()=>v(s),className:"px-3 py-2 rounded bg-white/5",children:"Edit"}),e.jsxs("button",{onClick:()=>k(s),disabled:s.id===(t==null?void 0:t.id),className:`px-3 py-2 rounded ${s.id===(t==null?void 0:t.id)?"bg-white/5 text-gray-500":"bg-blue-900/40 text-blue-300"}`,children:[s.is_admin?"Remove":"Make"," Admin"]}),e.jsx("button",{onClick:()=>C(s),disabled:s.id===(t==null?void 0:t.id),className:`px-3 py-2 rounded ${s.id===(t==null?void 0:t.id)?"bg-white/5 text-gray-500":"bg-red-900/40 text-red-300"}`,children:"Delete"})]})]},s.id))})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>p(!1),children:e.jsxs("div",{className:"bg-gray-900 border border-white/10 rounded-lg p-5 w-full max-w-md",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Add New User"}),x&&e.jsx("div",{className:"mb-2 bg-red-500/20 text-red-200 border border-red-500/40 rounded p-2",children:x}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{value:d.fullName,onChange:s=>h({...d,fullName:s.target.value}),placeholder:"Full name",className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"}),e.jsx("input",{value:d.password,onChange:s=>h({...d,password:s.target.value}),placeholder:"Password",type:"password",className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:d.is_admin,onChange:s=>h({...d,is_admin:s.target.checked})}),e.jsx("span",{children:"Admin"})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 rounded bg-white/10",children:"Cancel"}),e.jsx("button",{onClick:E,className:"px-4 py-2 rounded bg-sca-purple",children:"Create"})]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>c(null),children:e.jsxs("div",{className:"bg-gray-900 border border-white/10 rounded-lg p-5 w-full max-w-md",onClick:s=>s.stopPropagation(),children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["Edit User: ",r.username]}),y&&e.jsx("div",{className:"mb-2 bg-red-500/20 text-red-200 border border-red-500/40 rounded p-2",children:y}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Full name"}),e.jsx("input",{value:a.fullName,onChange:s=>u({...a,fullName:s.target.value}),className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400",children:"New password (optional)"}),e.jsx("input",{value:a.password,onChange:s=>u({...a,password:s.target.value}),type:"password",className:"w-full px-3 py-2 rounded bg-gray-800 border border-white/10"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a.is_admin,onChange:s=>u({...a,is_admin:s.target.checked}),disabled:r.id===(t==null?void 0:t.id)}),e.jsxs("span",{children:["Admin ",r.id===(t==null?void 0:t.id)?"(cannot modify own status)":""]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>c(null),className:"px-4 py-2 rounded bg-white/10",children:"Cancel"}),e.jsx("button",{onClick:F,className:"px-4 py-2 rounded bg-sca-purple",children:"Update"})]})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-500 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-400",children:"You don't have permission to access this page."})]})})}export{R as default};
