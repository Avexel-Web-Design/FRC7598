import{b as Ue,c as He,r as c,j as e,f as v}from"./main-hbWc4zaQ.js";import{g as q}from"./color-DkCkRny3.js";import{N as V}from"./NebulaLoader-BDXDAk84.js";import{f as we,a as Ne,b as ve,c as ke,d as Ce,e as _e,N as Se,I as $e,C as Me,T as De,R as Y,S as Ie,F as U,g as We,h as Be}from"./index-B-WFMlIl.js";const Ke=()=>{var be;const{user:a}=Ue(),{unreadCounts:G,markChannelAsRead:Re,refreshNotifications:Te,setActiveChannel:S}=He(),[K,J]=c.useState([]),[i,X]=c.useState(null),[j,$]=c.useState([]),[M,Z]=c.useState(""),[ee,se]=c.useState(!0),[Ee,te]=c.useState(!1),[ne,ae]=c.useState(!1),[ie,D]=c.useState(null),re=c.useRef(null),H=c.useRef(null),[w,E]=c.useState(null),[N,W]=c.useState(null),[le,L]=c.useState(null),[I,P]=c.useState(null),[oe,B]=c.useState(null),F=c.useRef(null),O=c.useRef(null),ce=c.useMemo(()=>[{key:"heart",icon:we,title:"Heart"},{key:"thumbs_up",icon:Ne,title:"Like"},{key:"thumbs_down",icon:ve,title:"Dislike"},{key:"laugh",icon:ke,title:"Laugh"},{key:"exclamation",icon:Ce,title:"Exclamation"},{key:"question",icon:_e,title:"Question"}],[]),Le=c.useMemo(()=>({heart:we,thumbs_up:Ne,thumbs_down:ve,laugh:ke,exclamation:Ce,question:_e}),[]),k=(s,t)=>{const[n,l]=[s,t].sort((u,m)=>u-m);return`dm_${n}_${l}`},de=s=>[...s].sort((t,n)=>new Date(t.timestamp)-new Date(n.timestamp)),ue=s=>{const t=new Date(s),n=new Date;return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate()?t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0}):t.toLocaleDateString(void 0,{month:"numeric",day:"numeric"})},Pe=async(s=!1)=>{if(a)try{s||se(!0),D(null);let t=[];const n=await v.get(`/chat/users/recent?user_id=${a.id}`);if(n.ok)t=await n.json();else{const o=await v.get("/chat/users");o.ok&&(t=(await o.json()).filter(d=>d.id!==a.id))}let l=[];const u=await v.get(`/chat/groups?user_id=${a.id}`);u.ok&&(l=await u.json());const m=[...l.map(o=>({...o,type:"group"})),...t.map(o=>({...o,type:"dm"}))];m.sort((o,d)=>{const f=o.type==="group"?o.last_activity||o.created_at||"":o.last_message_time||"",b=d.type==="group"?d.last_activity||d.created_at||"":d.last_message_time||"";if(f&&b)return b.localeCompare(f);if(f)return-1;if(b)return 1;const C=o.type==="group"?o.name:o.username,p=d.type==="group"?d.name:d.username;return C.localeCompare(p,void 0,{sensitivity:"base"})}),J(m)}catch{D("Error loading chats")}finally{s||se(!1)}};c.useEffect(()=>{a&&Pe()},[a]),c.useEffect(()=>{(async()=>{if(!(!i||!a)){te(!0),D(null);try{let t="";i.type==="dm"?t=`/chat/messages/dm/${k(a.id,i.id)}?user_id=${a.id}`:t=`/chat/messages/${i.id}?user_id=${a.id}`;const n=await v.get(t);n.ok?$(de(await n.json())):$([])}catch{$([])}finally{te(!1)}}})()},[i,a]),c.useEffect(()=>{var s;(s=re.current)==null||s.scrollIntoView({behavior:"smooth"})},[j]),c.useEffect(()=>()=>S(null),[S]),c.useEffect(()=>{if(i&&a){const s=i.type==="dm"?k(a.id,i.id):i.id.toString();S(s)}},[i,a,S]),c.useEffect(()=>{const s=t=>{const n=t.target,l=F.current&&n?F.current.contains(n):!1,u=O.current&&n?O.current.contains(n):!1;l||E(null),u||W(null)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[w,N]);const me=s=>{if(X(s),!a)return;const t=s.type==="dm"?k(a.id,s.id):s.id.toString();S(t),Re(t)},R=s=>{const t=s.match(/^::reply\[(\d+)\]::([\s\S]*)$/);return t?{replyId:parseInt(t[1],10),text:t[2]}:{replyId:null,text:s}},Fe=async s=>{if(s.preventDefault(),!(!M.trim()||!i||!a))try{const t=I?`::reply[${I.id}]::${M.trim()}`:M.trim();let n="";if(i.type==="dm"?n=`/chat/messages/dm/${k(a.id,i.id)}?user_id=${a.id}`:n=`/chat/messages/${i.id}?user_id=${a.id}`,(await v.post(n,{content:t,sender_id:a.id})).ok){const u=await v.get(n);u.ok&&$(de(await u.json())),Z(""),P(null),Te(),J(m=>{const o=m.findIndex(d=>d.type===i.type&&d.id===i.id);if(o>=0){const d=[...m],[f]=d.splice(o,1),b=new Date().toISOString();return f.type==="dm"?f.last_message_time=b:f.last_activity=b,d.unshift(f),d}return m})}}catch{D("Error sending message")}},pe=async(s,t)=>{if(a&&!(!(t!=null&&t.shiftKey)&&!window.confirm("Delete this message?"))){ae(!0);try{(await v.request("DELETE",`/chat/messages/${s}`,{user_id:a.id})).ok&&$(l=>l.filter(u=>u.id!==s))}catch{}finally{ae(!1)}}},xe=async s=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(s),!0}catch{}try{const t=document.createElement("textarea");t.value=s,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n}catch{return!1}},[he,Oe]=c.useState({}),[fe,ze]=c.useState({}),Q=(s,t)=>{Oe(n=>{var d;const l={...n[s]||{}},u=l[t]||0,m=!!((d=fe[s])!=null&&d.has(t)),o=Math.max(0,u+(m?-1:1));return o===0?delete l[t]:l[t]=o,{...n,[s]:l}}),ze(n=>{const l=new Set(n[s]||[]);return l.has(t)?l.delete(t):l.add(t),{...n,[s]:l}}),E(null)},Ae=s=>{const t=new Map(j.map(p=>[p.id,p])),n=new Map,l=new Map;for(const p of j){const{replyId:h}=R(p.content);if(h){n.set(p.id,h);const y=l.get(h)||[];y.push(p.id),l.set(h,y)}}const u=[],m=new Set;let o=s;for(;o!==void 0&&!m.has(o);){m.add(o);const p=n.get(o);if(p!=null){const h=t.get(p);h&&u.unshift(h),o=p}else break}const d=[],f=[s],b=new Set([s]);for(;f.length;){const p=f.shift(),h=l.get(p)||[];for(const y of h){if(b.has(y))continue;b.add(y);const z=t.get(y);z&&d.push(z),f.push(y)}}d.sort((p,h)=>new Date(p.timestamp)-new Date(h.timestamp));const C=t.get(s);return{items:[...u,...C?[C]:[],...d]}},ge=s=>!!a&&(a.isAdmin||s.sender_id===a.id);return e.jsxs("div",{className:"flex h-full w-full bg-black text-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"hidden md:flex w-64 bg-black flex-col",children:[e.jsx("div",{className:"px-2",children:e.jsx("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center",children:e.jsx("h2",{className:"text-xl font-bold",children:"Messages"})})}),ee?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx(V,{size:48})}):e.jsx("nav",{className:"flex-1 p-2 space-y-2 overflow-y-auto",children:K.map(s=>{const t=`${s.type}-${s.id}`,n=s.type==="group"?s.name:s.username,l=s.type==="group"?"#4b5563":s.avatar_color||q(n,null),u=s.type==="dm"&&a?k(a.id,s.id):s.id.toString(),m=G[u]||0;return e.jsx("button",{onClick:()=>me(s),className:`flex items-center justify-between w-full py-2 px-3 rounded-md transition-colors ${(i==null?void 0:i.type)===s.type&&(i==null?void 0:i.id)===s.id?"bg-sca-purple text-white":"hover:text-sca-purple"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm",style:{backgroundColor:l},children:n==null?void 0:n.split(" ").map(o=>o[0]).join("").toUpperCase().substring(0,2)}),m>0&&e.jsx(Se,{count:m,position:"top-right",size:"medium"})]}),e.jsx("span",{className:"truncate",children:n})]})},t)})})]}),e.jsx("div",{className:"md:hidden",children:i?null:e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-xl font-bold",children:"Messages"})}),ee?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(V,{size:48})}):e.jsx("div",{className:"space-y-3",children:K.map(s=>{const t=`${s.type}-${s.id}`,n=s.type==="group"?s.name:s.username,l=s.type==="group"?"#4b5563":s.avatar_color||q(n,null),u=s.type==="dm"&&a?k(a.id,s.id):s.id.toString(),m=G[u]||0;return e.jsx("button",{onClick:()=>me(s),className:"w-full text-left py-4 px-4 rounded-xl border border-gray-700 hover:border-sca-purple hover:bg-gray-800 active:bg-gray-700 transition-all duration-200 flex items-center justify-between mobile-touch-target",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-base",style:{backgroundColor:l},children:n==null?void 0:n.split(" ").map(o=>o[0]).join("").toUpperCase().substring(0,2)}),m>0&&e.jsx(Se,{count:m,position:"top-right",size:"medium"})]}),e.jsx("span",{className:"font-medium text-base",children:n})]})},t)})})]})}),e.jsxs("div",{className:`flex-1 flex flex-col min-h-0 ${i?"":"hidden md:flex"}`,children:[e.jsx("div",{className:"bg-black px-2",children:e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>X(null),className:"md:hidden mr-3 p-2 hover:text-sca-purple hover:bg-gray-800 rounded-lg transition-colors mobile-touch-target",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h2",{className:"text-lg md:text-xl font-bold truncate",children:i?i.type==="group"?i.name:i.username:"Select a chat"})]}),e.jsxs("div",{className:"hidden md:flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full mr-3 flex items-center justify-center text-white font-bold text-lg",style:{backgroundColor:a!=null&&a.name?q(a.name,(a==null?void 0:a.avatarColor)||null):"#471a67"},children:(be=a==null?void 0:a.name)==null?void 0:be.split(" ").map(s=>s[0]).join("").toUpperCase().substring(0,2)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-sm text-gray-400",children:"Online"})]})]})]})}),ie&&e.jsxs("div",{className:"bg-red-500 text-white p-2 text-sm text-center",children:[ie,e.jsx("button",{onClick:()=>D(null),className:"ml-2 font-bold",children:"×"})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto pb-20 md:pb-4",children:[Ee?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(V,{size:64})}):i?j.length>0?e.jsx("div",{className:"flex flex-col justify-end min-h-full",children:j.map((s,t)=>{var je;const n=!!a&&s.sender_id===a.id,l=t>0?j[t-1]:null,u=t<j.length-1?j[t+1]:null,m=(i==null?void 0:i.type)==="group",o=12e4,d=new Date(s.timestamp).getTime(),f=l?new Date(l.timestamp).getTime():0,b=u?new Date(u.timestamp).getTime():0,C=!!l&&l.sender_id===s.sender_id,p=!!u&&u.sender_id===s.sender_id,h=!(C&&d-f<=o),y=!(p&&b-d<=o),z=e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center text-white font-bold text-sm md:text-lg",style:{backgroundColor:s.sender_avatar_color||q(s.sender_username,null)},children:(je=s.sender_username)==null?void 0:je.split(" ").map(r=>r[0]).join("").toUpperCase().substring(0,2)}),qe=(()=>{const r=!n&&h&&m?"rounded-2xl":"rounded-3xl",x=[];return h||x.push(n?"rounded-tr-md":"rounded-tl-md"),y||x.push(n?"rounded-br-md":"rounded-bl-md"),[r,...x].join(" ")})(),_=R(s.content),A=_.replyId?j.find(r=>r.id===_.replyId):null,ye=A?R(A.content):null,T=ye?ye.text:"";return e.jsxs("div",{id:`msg-${s.id}`,className:`relative flex items-end gap-2 mb-1 ${h?"mt-3":"mt-0"} group ${n?"justify-end":"justify-start"}`,children:[!n&&m&&(y?e.jsx("div",{className:"self-end",children:z}):e.jsx("div",{className:"w-8 md:w-10"})),n&&e.jsxs("div",{className:`relative flex items-center gap-1 transition-opacity text-gray-400 ${w===s.id||N===s.id?"opacity-100":"opacity-0 group-hover:opacity-100"}`,ref:r=>{w===s.id&&(F.current=r),N===s.id&&(O.current=r)},children:[e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:r=>{r.stopPropagation(),W(N===s.id?null:s.id)},title:"Message info",children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:async r=>{r.stopPropagation(),await xe(_.text)&&(L(s.id),setTimeout(()=>L(g=>g===s.id?null:g),1200))},title:le===s.id?"Copied!":"Copy message",children:e.jsx(Me,{className:"w-4 h-4"})}),ge(s)&&e.jsx("button",{onClick:r=>pe(s.id,r),className:"hover:text-red-400 text-current",title:`Delete message
(Hold Shift to skip confirmation)`,disabled:ne,children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:r=>{r.stopPropagation(),P(s),setTimeout(()=>{var x;return(x=H.current)==null?void 0:x.focus()},0)},title:"Reply",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:r=>{r.stopPropagation(),E(w===s.id?null:s.id)},title:"Add reaction",children:e.jsx(Ie,{className:"w-4 h-4"})}),w===s.id&&e.jsx("div",{className:"absolute bottom-full right-0 mb-2 z-20",children:e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-2 shadow-xl whitespace-nowrap",children:e.jsx("div",{className:"flex items-center gap-1",children:ce.map(({key:r,icon:x,title:g})=>e.jsx("button",{type:"button",className:"px-1.5 py-1 rounded hover:bg-gray-800",title:g,onClick:()=>Q(s.id,r),children:e.jsx(U,{icon:x,className:"w-4 h-4"})},r))})})}),N===s.id&&e.jsx("div",{className:"absolute bottom-full right-full mr-2 mb-2 z-20",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-3 shadow-xl text-sm min-w-[260px] max-w-xs",children:[e.jsx("div",{className:"text-gray-300 font-medium mb-1",children:"Message info"}),e.jsxs("div",{className:"text-gray-400",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"From:"})," ",s.sender_username]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"ID:"})," ",s.id]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Sent:"})," ",new Date(s.timestamp).toLocaleString()]}),i&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Chat:"})," ",i.type==="group"?i.name:i.username]})]})]})})]}),e.jsxs("div",{className:`max-w-[85%] px-3 py-2 ${qe} shadow-sm ${n?"bg-sca-purple text-white":"bg-gray-800 text-gray-100"}`,children:[_.replyId&&e.jsx("button",{type:"button",onClick:()=>B(s.id),className:`mb-1 text-xs rounded-md px-2 py-1 border ${n?"bg-white/10 border-white/30 text-white/90":"bg-black/20 border-white/10 text-gray-300"}`,title:"View replied message",children:e.jsxs("span",{className:"opacity-80",children:["Replying to ",A?A.sender_username:"message",": ",T==null?void 0:T.slice(0,80),T&&T.length>80?"…":""]})}),!n&&h&&m&&e.jsx("div",{className:"text-xs font-semibold mb-1 opacity-90",children:s.sender_username}),e.jsxs("div",{className:`whitespace-pre-wrap break-words ${n?"text-right":""}`,children:[e.jsx("span",{children:_.text}),y&&e.jsxs("span",{className:`ml-2 text-[10px] ${n?"text-white/80":"text-gray-400"} whitespace-nowrap align-baseline`,children:[ue(s.timestamp),n&&e.jsx("span",{className:"ml-1 inline-flex items-center align-baseline",children:e.jsx(U,{icon:s.read_by_any?We:Be,className:"w-3.5 h-3.5 opacity-90",title:s.read_by_any?"Read":"Sent"})})]}),Object.keys(he[s.id]||{}).length>0&&e.jsx("div",{className:`mt-1 flex flex-wrap gap-1 ${n?"justify-end":"justify-start"}`,children:Object.entries(he[s.id]).map(([r,x])=>{var g;return e.jsxs("button",{type:"button",onClick:()=>Q(s.id,r),className:`px-1.5 py-0.5 rounded-full text-xs border transition-colors ${(g=fe[s.id])!=null&&g.has(r)?n?"bg-white/20 border-white/40":"bg-white/10 border-white/20":n?"bg-black/10 border-white/20":"bg-black/20 border-white/10"}`,title:"Toggle reaction",children:[e.jsx(U,{icon:Le[r],className:"w-3.5 h-3.5 mr-1 inline-block"}),e.jsx("span",{className:"tabular-nums",children:x})]},r)})})]})]}),!n&&e.jsxs("div",{className:`relative flex items-center gap-1 transition-opacity text-gray-400 ${w===s.id||N===s.id?"opacity-100":"opacity-0 group-hover:opacity-100"}`,ref:r=>{w===s.id&&(F.current=r),N===s.id&&(O.current=r)},children:[e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:r=>{r.stopPropagation(),E(w===s.id?null:s.id)},title:"Add reaction",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:r=>{r.stopPropagation(),P(s),setTimeout(()=>{var x;return(x=H.current)==null?void 0:x.focus()},0)},title:"Reply",children:e.jsx(Y,{className:"w-4 h-4"})}),ge(s)&&e.jsx("button",{onClick:r=>pe(s.id,r),className:"hover:text-red-400 text-current",title:`Delete message
(Hold Shift to skip confirmation)`,disabled:ne,children:e.jsx(De,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:async r=>{r.stopPropagation(),await xe(_.text)&&(L(s.id),setTimeout(()=>L(g=>g===s.id?null:g),1200))},title:le===s.id?"Copied!":"Copy message",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",className:"hover:text-sca-purple",onClick:r=>{r.stopPropagation(),W(N===s.id?null:s.id)},title:"Message info",children:e.jsx($e,{className:"w-4 h-4"})}),w===s.id&&e.jsx("div",{className:"absolute bottom-full left-0 mb-2 z-20",children:e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-2 shadow-xl whitespace-nowrap",children:e.jsx("div",{className:"flex items-center gap-1",children:ce.map(({key:r,icon:x,title:g})=>e.jsx("button",{type:"button",className:"px-1.5 py-1 rounded hover:bg-gray-800",title:g,onClick:()=>Q(s.id,r),children:e.jsx(U,{icon:x,className:"w-4 h-4"})},r))})})}),N===s.id&&e.jsx("div",{className:"absolute bottom-full left-full ml-2 mb-2 z-20",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-3 shadow-xl text-sm min-w-[260px] max-w-xs",children:[e.jsx("div",{className:"text-gray-300 font-medium mb-1",children:"Message info"}),e.jsxs("div",{className:"text-gray-400",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"From:"})," ",s.sender_username]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"ID:"})," ",s.id]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Sent:"})," ",new Date(s.timestamp).toLocaleString()]}),i&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Chat:"})," ",i.type==="group"?i.name:i.username]})]})]})})]})]},s.id)})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-400",children:"No messages yet. Say hi!"})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-400",children:"Select a chat to start messaging."})}),e.jsx("div",{ref:re})]}),e.jsx("div",{className:"bg-black px-2 pb-safe sticky bottom-0 md:relative md:bottom-auto",children:e.jsxs("div",{className:"p-4 border-t border-gray-700",children:[I&&e.jsxs("div",{className:"mb-2 flex items-center gap-2 rounded-md border border-gray-700 bg-gray-900 p-2",children:[e.jsx(Y,{className:"w-4 h-4 text-sca-purple"}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:["Replying to ",I.sender_username]}),e.jsx("div",{className:"text-sm truncate",children:R(I.content).text})]}),e.jsx("button",{type:"button",className:"text-gray-400 hover:text-red-400 px-2",title:"Cancel reply",onClick:()=>P(null),children:"×"})]}),e.jsxs("form",{onSubmit:Fe,className:"flex space-x-2",children:[e.jsx("input",{type:"text",ref:H,value:M,onChange:s=>Z(s.target.value),placeholder:i?`Message ${i.type==="group"?i.name:i.username}`:"Select a chat...",className:"flex-1 bg-gray-800 text-gray-100 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-sca-purple border border-gray-600",disabled:!i}),e.jsxs("button",{type:"submit",className:"bg-sca-purple hover:bg-sca-purple/80 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!i||!M.trim(),children:[e.jsx("span",{className:"hidden sm:inline",children:"Send"}),e.jsx("svg",{className:"w-5 h-5 sm:hidden",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})]})]})]})})]}),oe!=null&&(()=>{const{items:s}=Ae(oe);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>B(null),children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-y-auto p-4",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Thread"}),e.jsx("button",{className:"text-gray-400 hover:text-white",onClick:()=>B(null),title:"Close",children:"×"})]}),e.jsx("div",{className:"space-y-3",children:s.map(t=>{const n=!!a&&t.sender_id===a.id,l=R(t.content);return e.jsxs("div",{className:`p-3 rounded-xl border ${n?"bg-sca-purple/10 border-sca-purple/40":"bg-black/30 border-white/10"}`,children:[e.jsxs("div",{className:"text-xs text-gray-400 mb-1 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-300",children:t.sender_username}),e.jsx("span",{children:ue(t.timestamp)})]}),e.jsx("div",{className:"whitespace-pre-wrap break-words",children:l.text})]},`thread-${t.id}`)})})]})})})()]})};export{Ke as default};
