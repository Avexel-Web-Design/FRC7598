import{b as K,r as x,j as e,f as N}from"./main-Da7mm-km.js";import{F as W,c as U,d as B}from"./index-DXFDpy_a.js";import{N as G}from"./NebulaLoader-YoIkvoO_.js";const F=b=>{if(!b)return"";const[w,k]=b.split(":"),f=parseInt(w,10),O=f===0?12:f>12?f-12:f,M=f>=12?"PM":"AM";return`${O}:${k} ${M}`};function Z(){const{user:b}=K(),[w,k]=x.useState([]),[f,O]=x.useState(!0),[M,v]=x.useState(!1),[m,j]=x.useState(!1),[s,i]=x.useState(null),[d,A]=x.useState(new Date),[y,h]=x.useState(!1),I=({recurrence:t,onChange:r,eventDate:n})=>{const c=[{value:"sunday",label:"Sun"},{value:"monday",label:"Mon"},{value:"tuesday",label:"Tue"},{value:"wednesday",label:"Wed"},{value:"thursday",label:"Thu"},{value:"friday",label:"Fri"},{value:"saturday",label:"Sat"}],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=[{value:1,label:"First"},{value:2,label:"Second"},{value:3,label:"Third"},{value:4,label:"Fourth"},{value:-1,label:"Last"}],u=()=>{if(!n)return"monday";const a=new Date(n+"T00:00:00");return c[a.getDay()].value},S=()=>n?new Date(n+"T00:00:00").getDate():1,E=()=>{if(!n)return 1;const a=new Date(n+"T00:00:00"),p=new Date(a.getFullYear(),a.getMonth(),1),_=a.getDate()+p.getDay()-1;return Math.floor(_/7)+1},g=a=>r({...t,...a}),q=a=>{const p=t.daysOfWeek||[u()],_=p.includes(a)?p.filter(C=>C!==a):[...p,a];g({daysOfWeek:_})},H=a=>{const p=t.months||[],_=p.includes(a+1)?p.filter(C=>C!==a+1):[...p,a+1];g({months:_})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Repeat"}),e.jsxs("select",{value:t.type,onChange:a=>g({type:a.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Every"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"99",value:t.interval,onChange:a=>g({interval:parseInt(a.target.value)||1}),className:"w-20 bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"}),e.jsxs("span",{className:"text-gray-300",children:[t.type==="daily"&&(t.interval===1?"day":"days"),t.type==="weekly"&&(t.interval===1?"week":"weeks"),t.type==="monthly"&&(t.interval===1?"month":"months"),t.type==="yearly"&&(t.interval===1?"year":"years")]})]})]}),t.type==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"On days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(a=>e.jsx("button",{type:"button",onClick:()=>q(a.value),className:(t.daysOfWeek||[u()]).includes(a.value)?"px-3 py-1 rounded text-sm font-medium bg-sca-purple text-white":"px-3 py-1 rounded text-sm font-medium bg-gray-700 text-gray-300 hover:bg-gray-600",children:a.label},a.value))})]}),t.type==="monthly"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"monthlyType",checked:!!t.dayOfMonth,onChange:()=>g({dayOfMonth:S(),weekOfMonth:void 0,dayOfWeek:void 0}),className:"text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{className:"text-gray-300",children:"On day"}),e.jsx("input",{type:"number",min:"1",max:"31",value:t.dayOfMonth||S(),onChange:a=>g({dayOfMonth:parseInt(a.target.value)||1}),disabled:!t.dayOfMonth,className:"w-16 bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50"}),e.jsx("span",{className:"text-gray-300",children:"of the month"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"monthlyType",checked:!!t.weekOfMonth&&!!t.dayOfWeek,onChange:()=>g({weekOfMonth:E(),dayOfWeek:u(),dayOfMonth:void 0}),className:"text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{className:"text-gray-300",children:"On the"}),e.jsx("select",{value:t.weekOfMonth||E(),onChange:a=>g({weekOfMonth:parseInt(a.target.value)}),disabled:!t.weekOfMonth,className:"bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50",children:l.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("select",{value:t.dayOfWeek||u(),onChange:a=>g({dayOfWeek:a.target.value}),disabled:!t.weekOfMonth,className:"bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50",children:c.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),t.type==="yearly"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"In months"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:o.map((a,p)=>e.jsx("button",{type:"button",onClick:()=>H(p),className:(t.months||[new Date(n+"T00:00:00").getMonth()+1]).includes(p+1)?"px-3 py-2 rounded text-sm font-medium bg-sca-purple text-white":"px-3 py-2 rounded text-sm font-medium bg-gray-700 text-gray-300 hover:bg-gray-600",children:a},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Ends"}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"endType",value:"never",checked:t.endType==="never",onChange:()=>r({...t,endType:"never"}),className:"text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{className:"text-gray-300",children:"Never"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"endType",value:"after_occurrences",checked:t.endType==="after_occurrences",onChange:()=>r({...t,endType:"after_occurrences"}),className:"text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{className:"text-gray-300",children:"After"}),e.jsx("input",{type:"number",min:"1",max:"999",value:t.occurrences||10,onChange:a=>r({...t,occurrences:parseInt(a.target.value)||10}),disabled:t.endType!=="after_occurrences",className:"w-20 bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50"}),e.jsx("span",{className:"text-gray-300",children:"occurrences"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"endType",value:"end_date",checked:t.endType==="end_date",onChange:()=>r({...t,endType:"end_date"}),className:"text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{className:"text-gray-300",children:"On"}),e.jsx("input",{type:"date",value:t.endDate||"",min:n,onChange:a=>r({...t,endDate:a.target.value}),disabled:t.endType!=="end_date",className:"bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50"})]})]})]})},T=async()=>{try{const t=new Date(d.getFullYear(),d.getMonth()-1,1),r=new Date(d.getFullYear(),d.getMonth()+2,0),n=t.toISOString().split("T")[0],c=r.toISOString().split("T")[0],o=await N.get(`/calendar?start=${n}&end=${c}`);if(o.ok){const l=await o.json();k(l)}}catch(t){console.error("Error fetching events",t)}finally{O(!1)}};x.useEffect(()=>{T()},[d]);const J=x.useMemo(()=>{const t=d.getFullYear(),r=d.getMonth(),n=new Date(t,r,1),c=new Date(n);c.setDate(c.getDate()-n.getDay());const o=[];for(let l=0;l<42;l++){const u=new Date(c);u.setDate(c.getDate()+l),o.push(u)}return o},[d]),$=t=>{const r=t.toISOString().split("T")[0];return w.filter(n=>n.event_date===r)},D=t=>A(new Date(d.getFullYear(),d.getMonth()+t,1)),R=t=>{t.getMonth()===d.getMonth()&&(j(!1),h(!1),i({event_date:t.toISOString().split("T")[0],recurrence:{type:"weekly",interval:1,endType:"never"}}),v(!0))},P=async t=>{if(j(!0),h(!!t.is_recurring),t.is_recurring_instance&&t.parent_event_id)try{const r=await N.get(`/calendar/${t.parent_event_id}`);if(r.ok){const n=await r.json();i({...t,recurrence:{type:n.recurrence_type||"weekly",interval:n.recurrence_interval||1,daysOfWeek:n.recurrence_days_of_week?JSON.parse(n.recurrence_days_of_week):void 0,dayOfMonth:n.recurrence_day_of_month,weekOfMonth:n.recurrence_week_of_month,dayOfWeek:n.recurrence_day_of_week,months:n.recurrence_months?JSON.parse(n.recurrence_months):void 0,endType:n.recurrence_end_type||"never",endDate:n.recurrence_end_date,occurrences:n.recurrence_occurrences,exceptions:n.recurrence_exceptions?JSON.parse(n.recurrence_exceptions):[]}})}else i({...t,recurrence:{type:"weekly",interval:1,endType:"never"}})}catch{i({...t,recurrence:{type:"weekly",interval:1,endType:"never"}})}else t.is_recurring?i({...t,recurrence:{type:t.recurrence_type||"weekly",interval:t.recurrence_interval||1,daysOfWeek:t.recurrence_days_of_week?JSON.parse(t.recurrence_days_of_week):void 0,dayOfMonth:t.recurrence_day_of_month,weekOfMonth:t.recurrence_week_of_month,dayOfWeek:t.recurrence_day_of_week,months:t.recurrence_months?JSON.parse(t.recurrence_months):void 0,endType:t.recurrence_end_type||"never",endDate:t.recurrence_end_date,occurrences:t.recurrence_occurrences,exceptions:t.recurrence_exceptions?JSON.parse(t.recurrence_exceptions):[]}}):i({...t,recurrence:{type:"weekly",interval:1,endType:"never"}});v(!0)},Y=async()=>{if(!s)return;const t=typeof s.id=="string"&&s.id.includes("_");let r=s.id;t&&(r=s.parent_event_id);const n=m?`/calendar/${r}`:"/calendar",c=m?"PUT":"POST",o={...s,is_recurring:m&&(s.is_recurring||s.is_recurring_instance)||y,recurrence:m&&(s.is_recurring||s.is_recurring_instance)||y?s.recurrence:void 0,update_series:(s==null?void 0:s.update_series)||!1,original_instance_date:t?s.id.split("_")[1]:void 0};(await N[c.toLowerCase()](n,o)).ok&&(await T(),v(!1),i(null),j(!1),h(!1))},L=async t=>{const r=typeof t=="string"&&t.includes("_"),n=(s==null?void 0:s.is_recurring)||(s==null?void 0:s.is_recurring_instance);let c=!1;if(r||n)if(s!=null&&s.update_series)c=!0;else{const u=window.confirm(`This is a recurring event.

OK = Just this instance
Cancel = Delete the entire series`);if(c=!u,u===null)return}else if(!window.confirm("Are you sure you want to delete this event?"))return;const o=r?t.split("_")[0]:t;(await N.request("DELETE",`/calendar/${o}`,{delete_series:c,exception_date:r&&!c?t.split("_")[1]:void 0})).ok&&(await T(),v(!1),i(null),j(!1),h(!1))};if(f)return e.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:e.jsx(G,{size:96})});const z=["January","February","March","April","May","June","July","August","September","October","November","December"];return e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Team Calendar"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Manage team events, competitions, and meetings"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>D(-1),className:"p-2 rounded-md hover:text-sca-gold","aria-label":"Previous month",title:"Previous month",children:e.jsx(W,{icon:U,className:"w-4 h-4"})}),e.jsxs("div",{className:"text-gray-300",children:[z[d.getMonth()]," ",d.getFullYear()]}),e.jsx("button",{onClick:()=>D(1),className:"p-2 rounded-md hover:text-sca-gold","aria-label":"Next month",title:"Next month",children:e.jsx(W,{icon:B,className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-white/10",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(t=>e.jsx("div",{className:"bg-black px-3 py-2 text-center text-xs font-medium text-gray-400 uppercase",children:t},t)),J.map((t,r)=>{const n=t.getMonth()===d.getMonth(),c=t.toDateString()===new Date().toDateString(),o=$(t);return e.jsxs("div",{className:`bg-black px-3 py-1 sm:py-2 text-sm min-h-[80px] sm:min-h-[110px] cursor-pointer hover:bg-white/5 ${n?"text-gray-100":"text-gray-500"} ${c?"ring-1 ring-sca-purple/60":""}`,onClick:()=>R(t),children:[e.jsx("div",{className:`font-medium ${c?"text-sca-gold":""}`,children:t.getDate()}),e.jsxs("div",{className:"mt-1 space-y-1",children:[o.slice(0,3).map(l=>e.jsxs("div",{className:`text-xs -mx-3 px-0 py-1 sm:mx-0 sm:px-1 rounded truncate cursor-pointer transition-colors ${l.is_recurring||l.is_recurring_instance,"bg-sca-purple/25 text-sca-gold hover:bg-sca-purple/40"}`,onClick:u=>{u.stopPropagation(),P(l)},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[(l.is_recurring||l.is_recurring_instance)&&e.jsx("span",{children:"âŸ³"}),e.jsx("span",{className:"truncate",children:l.title})]}),l.event_time&&e.jsxs("div",{className:"text-xs opacity-75 mt-0.5",children:[F(l.event_time),l.event_end_time&&` - ${F(l.event_end_time)}`]})]},l.id)),o.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",o.length-3," more"]})]})]},r)})]})})}),M&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"relative p-8 bg-black w-full max-w-2xl m-auto rounded-lg shadow-lg border border-white/10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-medium mb-6",children:[m?"Edit Event":"Add New Event",s.is_recurring_instance&&e.jsx("span",{className:"ml-2 text-sm text-sca-gold",children:"(Recurring Event)"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title"}),e.jsx("input",{type:"text",value:s.title||"",onChange:t=>i({...s,title:t.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:s.description||"",onChange:t=>i({...s,description:t.target.value}),rows:3,className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Date"}),e.jsx("input",{type:"date",value:s.event_date||"",onChange:t=>i({...s,event_date:t.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Time"}),e.jsx("input",{type:"time",value:s.event_time||"",onChange:t=>i({...s,event_time:t.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"End Time (Optional)"}),e.jsx("input",{type:"time",value:s.event_end_time||"",onChange:t=>i({...s,event_end_time:t.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),e.jsx("input",{type:"text",value:s.location||"",onChange:t=>i({...s,location:t.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{className:"space-y-4",children:[!m&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:t=>h(t.target.checked),className:"rounded border-gray-600 text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{className:"text-gray-300",children:"Make this a recurring event"})]}),m&&(s.is_recurring||s.is_recurring_instance)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:s.is_recurring_instance?"Part of recurring series":"Recurring event"}),e.jsxs("button",{type:"button",onClick:()=>h(!y),className:"text-sm text-sca-gold hover:text-white",children:[y?"Hide":"Edit"," recurrence settings"]})]}),s.is_recurring_instance&&e.jsxs("div",{className:"text-sm text-gray-400 bg-gray-800 p-3 rounded border border-gray-600",children:[e.jsx("p",{className:"mb-2",children:"You're editing a single occurrence of a recurring event."}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.update_series||!1,onChange:t=>i({...s,update_series:t.target.checked}),className:"rounded border-gray-600 text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{children:"Apply changes to entire series"})]})]})]}),m&&!s.is_recurring&&!s.is_recurring_instance&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:t=>h(t.target.checked),className:"rounded border-gray-600 text-sca-purple focus:ring-sca-purple"}),e.jsx("span",{className:"text-gray-300",children:"Make this a recurring event"})]})]}),y&&s.recurrence&&e.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-200 mb-4",children:"Recurrence Settings"}),e.jsx(I,{recurrence:s.recurrence,onChange:t=>i({...s,recurrence:t}),eventDate:s.event_date||""})]})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsx("div",{children:m&&(b==null?void 0:b.isAdmin)&&e.jsx("button",{onClick:()=>L(s.id),className:"px-4 py-2 text-sm font-medium text-red-400 hover:text-red-300",children:"Delete"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{v(!1),i(null),j(!1),h(!1)},className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white",children:"Cancel"}),e.jsx("button",{onClick:Y,className:"px-4 py-2 text-sm font-medium text-black bg-sca-gold hover:bg-yellow-400 rounded",children:m?"Save Changes":"Create Event"})]})]})]})})]})}export{Z as default};
