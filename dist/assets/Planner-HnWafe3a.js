import{b as S,r as l,f as x,j as e}from"./main-DpKI8Nrd.js";import{N as P}from"./NebulaLoader-DGa72XLy.js";function U(){const{user:a}=S(),[r,u]=l.useState([]),[y,f]=l.useState(!0),[v,p]=l.useState(!1),[s,d]=l.useState(null),[m,b]=l.useState("pending"),[w,N]=l.useState([]),[i,c]=l.useState({title:"",description:"",assigned_to:"",due_date:"",priority:"medium"});l.useEffect(()=>{h(),k()},[]);const h=async()=>{f(!0);try{const t=await x.get("/tasks");t.ok&&u(await t.json())}finally{f(!1)}},k=async()=>{try{if(a!=null&&a.isAdmin){const t=await x.get("/admin/users");t.ok&&N(await t.json())}}catch{}},_=async()=>{const t={...i,assigned_to:i.assigned_to?parseInt(i.assigned_to):null};(await x.post("/tasks",t)).ok&&(await h(),p(!1),c({title:"",description:"",assigned_to:"",due_date:"",priority:"medium"}))},C=async(t,g)=>{(await x.put(`/tasks/${t}`,g)).ok&&(await h(),d(null))},T=async t=>{if(!window.confirm("Delete this task?"))return;(await x.delete(`/tasks/${t}`)).ok&&u(r.filter(n=>n.id!==t))},D=async t=>{(await x.request("PATCH",`/tasks/${t.id}/complete`,{completed:!t.completed})).ok&&u(r.map(n=>n.id===t.id?{...n,completed:!n.completed}:n))},j=r.filter(t=>m==="pending"?!t.completed:t.completed),o={total:r.length,completed:r.filter(t=>t.completed).length,pending:r.filter(t=>!t.completed).length,overdue:r.filter(t=>!t.completed&&t.due_date&&new Date(t.due_date)<new Date).length};if(y)return e.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:e.jsx(P,{size:96})});const A=t=>({high:"bg-red-500/20 text-red-300",medium:"bg-yellow-500/20 text-yellow-200",low:"bg-green-500/20 text-green-300"})[t]||"bg-gray-500/20 text-gray-300";return e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Planner"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Track and manage team tasks"})]}),e.jsx("button",{onClick:()=>p(!0),className:"px-3 py-2 text-sm font-medium text-black bg-sca-gold hover:bg-yellow-400 rounded",children:"Add Task"})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"border border-white/10 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-sca-purple rounded-md flex items-center justify-center text-sca-gold font-bold",children:o.pending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Pending"}),e.jsx("div",{className:"text-white text-lg font-medium",children:o.pending})]})]})}),e.jsx("div",{className:"border border-white/10 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-600 rounded-md flex items-center justify-center text-white font-bold",children:o.completed}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Completed"}),e.jsx("div",{className:"text-white text-lg font-medium",children:o.completed})]})]})}),e.jsx("div",{className:"border border-white/10 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-600 rounded-md flex items-center justify-center text-white font-bold",children:o.overdue}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Overdue"}),e.jsx("div",{className:"text-white text-lg font-medium",children:o.overdue})]})]})})]}),e.jsxs("div",{className:"px-4",children:[e.jsx("div",{className:"border border-white/10 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>b("pending"),className:`px-3 py-2 rounded text-sm ${m==="pending"?"bg-sca-purple/30 text-sca-gold":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Pending"}),e.jsx("button",{onClick:()=>b("completed"),className:`px-3 py-2 rounded text-sm ${m==="completed"?"bg-green-600/25 text-green-300":"bg-gray-800 text-gray-400 hover:text-white"}`,children:"Completed"})]})}),e.jsxs("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-white/10",children:e.jsx("h3",{className:"text-lg font-medium",children:m==="pending"?"Pending Tasks":"Completed Tasks"})}),e.jsx("div",{className:"divide-y divide-white/10",children:j.length>0?j.map(t=>e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:!!t.completed,onChange:()=>D(t),className:"h-4 w-4 text-sca-purple focus:ring-sca-purple border-gray-600 rounded bg-black"}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-sm font-medium ${t.completed?"text-gray-500 line-through":"text-white"}`,children:t.title}),e.jsx("p",{className:`text-sm ${t.completed?"text-gray-400":"text-gray-500"}`,children:t.description}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-4 text-xs text-gray-400",children:[e.jsxs("span",{children:["Created by: ",t.creator_username||"Unknown"]}),t.assignee_username&&e.jsxs("span",{children:["Assigned to: ",t.assignee_username]}),t.due_date&&e.jsxs("span",{className:new Date(t.due_date)<new Date&&!t.completed?"text-red-400":"",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${A(t.priority)}`,children:t.priority}),((a==null?void 0:a.isAdmin)||t.created_by===(a==null?void 0:a.id))&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(t),className:"text-sca-gold hover:text-white text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>T(t.id),className:"text-red-500 hover:text-red-400 text-sm",children:"Delete"})]})]})]})},t.id)):e.jsx("div",{className:"px-6 py-8 text-center text-gray-400",children:"No tasks found"})})]})]}),(v||s)&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"relative p-6 bg-black w-full max-w-md rounded-lg border border-white/10",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:s?"Edit Task":"Add New Task"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Title"}),e.jsx("input",{type:"text",value:s?s.title:i.title,onChange:t=>s?d({...s,title:t.target.value}):c({...i,title:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Description"}),e.jsx("textarea",{rows:3,value:s?s.description:i.description,onChange:t=>s?d({...s,description:t.target.value}):c({...i,description:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Priority"}),e.jsxs("select",{value:s?s.priority:i.priority,onChange:t=>s?d({...s,priority:t.target.value}):c({...i,priority:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Due Date"}),e.jsx("input",{type:"date",value:s?s.due_date||"":i.due_date,onChange:t=>s?d({...s,due_date:t.target.value}):c({...i,due_date:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),(a==null?void 0:a.isAdmin)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Assign To"}),e.jsxs("select",{value:s?s.assigned_to??"":i.assigned_to,onChange:t=>s?d({...s,assigned_to:t.target.value?parseInt(t.target.value):null}):c({...i,assigned_to:t.target.value}),className:"mt-1 block w-full bg-gray-900 border border-gray-700 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple",children:[e.jsx("option",{value:"",children:"Unassigned"}),w.map(t=>e.jsx("option",{value:t.id,children:t.username},t.id))]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{p(!1),d(null)},className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white",children:"Cancel"}),e.jsxs("button",{onClick:()=>{s?C(s.id,s):_()},className:"px-4 py-2 text-sm font-medium text-black bg-sca-gold hover:bg-yellow-400 rounded",children:[s?"Update":"Create"," Task"]})]})]})})]})}export{U as default};
