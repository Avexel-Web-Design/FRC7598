import{b as q,r as g,j as t,f as w}from"./main-hbWc4zaQ.js";import{N as H}from"./NebulaLoader-BDXDAk84.js";const k=b=>{if(!b)return"";const[v,O]=b.split(":"),f=parseInt(v,10),M=f===0?12:f>12?f-12:f,D=f>=12?"PM":"AM";return`${M}:${O} ${D}`};function G(){const{user:b}=q(),[v,O]=g.useState([]),[f,M]=g.useState(!0),[D,j]=g.useState(!1),[m,_]=g.useState(!1),[s,i]=g.useState(null),[d,F]=g.useState(new Date),[h,y]=g.useState(!1),A=({recurrence:e,onChange:r,eventDate:n})=>{const c=[{value:"sunday",label:"Sun"},{value:"monday",label:"Mon"},{value:"tuesday",label:"Tue"},{value:"wednesday",label:"Wed"},{value:"thursday",label:"Thu"},{value:"friday",label:"Fri"},{value:"saturday",label:"Sat"}],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=[{value:1,label:"First"},{value:2,label:"Second"},{value:3,label:"Third"},{value:4,label:"Fourth"},{value:-1,label:"Last"}],u=()=>{if(!n)return"monday";const a=new Date(n+"T00:00:00");return c[a.getDay()].value},W=()=>n?new Date(n+"T00:00:00").getDate():1,$=()=>{if(!n)return 1;const a=new Date(n+"T00:00:00"),p=new Date(a.getFullYear(),a.getMonth(),1),N=a.getDate()+p.getDay()-1;return Math.floor(N/7)+1},x=a=>r({...e,...a}),z=a=>{const p=e.daysOfWeek||[u()],N=p.includes(a)?p.filter(C=>C!==a):[...p,a];x({daysOfWeek:N})},U=a=>{const p=e.months||[],N=p.includes(a+1)?p.filter(C=>C!==a+1):[...p,a+1];x({months:N})};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Repeat"}),t.jsxs("select",{value:e.type,onChange:a=>x({type:a.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple",children:[t.jsx("option",{value:"daily",children:"Daily"}),t.jsx("option",{value:"weekly",children:"Weekly"}),t.jsx("option",{value:"monthly",children:"Monthly"}),t.jsx("option",{value:"yearly",children:"Yearly"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Every"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"number",min:"1",max:"99",value:e.interval,onChange:a=>x({interval:parseInt(a.target.value)||1}),className:"w-20 bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"}),t.jsxs("span",{className:"text-gray-300",children:[e.type==="daily"&&(e.interval===1?"day":"days"),e.type==="weekly"&&(e.interval===1?"week":"weeks"),e.type==="monthly"&&(e.interval===1?"month":"months"),e.type==="yearly"&&(e.interval===1?"year":"years")]})]})]}),e.type==="weekly"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"On days"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(a=>t.jsx("button",{type:"button",onClick:()=>z(a.value),className:(e.daysOfWeek||[u()]).includes(a.value)?"px-3 py-1 rounded text-sm font-medium bg-sca-purple text-white":"px-3 py-1 rounded text-sm font-medium bg-gray-700 text-gray-300 hover:bg-gray-600",children:a.label},a.value))})]}),e.type==="monthly"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"radio",name:"monthlyType",checked:!!e.dayOfMonth,onChange:()=>x({dayOfMonth:W(),weekOfMonth:void 0,dayOfWeek:void 0}),className:"text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{className:"text-gray-300",children:"On day"}),t.jsx("input",{type:"number",min:"1",max:"31",value:e.dayOfMonth||W(),onChange:a=>x({dayOfMonth:parseInt(a.target.value)||1}),disabled:!e.dayOfMonth,className:"w-16 bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50"}),t.jsx("span",{className:"text-gray-300",children:"of the month"})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"radio",name:"monthlyType",checked:!!e.weekOfMonth&&!!e.dayOfWeek,onChange:()=>x({weekOfMonth:$(),dayOfWeek:u(),dayOfMonth:void 0}),className:"text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{className:"text-gray-300",children:"On the"}),t.jsx("select",{value:e.weekOfMonth||$(),onChange:a=>x({weekOfMonth:parseInt(a.target.value)}),disabled:!e.weekOfMonth,className:"bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50",children:l.map(a=>t.jsx("option",{value:a.value,children:a.label},a.value))}),t.jsx("select",{value:e.dayOfWeek||u(),onChange:a=>x({dayOfWeek:a.target.value}),disabled:!e.weekOfMonth,className:"bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50",children:c.map(a=>t.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),e.type==="yearly"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"In months"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:o.map((a,p)=>t.jsx("button",{type:"button",onClick:()=>U(p),className:(e.months||[new Date(n+"T00:00:00").getMonth()+1]).includes(p+1)?"px-3 py-2 rounded text-sm font-medium bg-sca-purple text-white":"px-3 py-2 rounded text-sm font-medium bg-gray-700 text-gray-300 hover:bg-gray-600",children:a},a))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Ends"}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"radio",name:"endType",value:"never",checked:e.endType==="never",onChange:()=>r({...e,endType:"never"}),className:"text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{className:"text-gray-300",children:"Never"})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"radio",name:"endType",value:"after_occurrences",checked:e.endType==="after_occurrences",onChange:()=>r({...e,endType:"after_occurrences"}),className:"text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{className:"text-gray-300",children:"After"}),t.jsx("input",{type:"number",min:"1",max:"999",value:e.occurrences||10,onChange:a=>r({...e,occurrences:parseInt(a.target.value)||10}),disabled:e.endType!=="after_occurrences",className:"w-20 bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50"}),t.jsx("span",{className:"text-gray-300",children:"occurrences"})]}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"radio",name:"endType",value:"end_date",checked:e.endType==="end_date",onChange:()=>r({...e,endType:"end_date"}),className:"text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{className:"text-gray-300",children:"On"}),t.jsx("input",{type:"date",value:e.endDate||"",min:n,onChange:a=>r({...e,endDate:a.target.value}),disabled:e.endType!=="end_date",className:"bg-gray-800 border border-gray-600 text-gray-100 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sca-purple disabled:opacity-50"})]})]})]})},T=async()=>{try{const e=new Date(d.getFullYear(),d.getMonth()-1,1),r=new Date(d.getFullYear(),d.getMonth()+2,0),n=e.toISOString().split("T")[0],c=r.toISOString().split("T")[0],o=await w.get(`/calendar?start=${n}&end=${c}`);if(o.ok){const l=await o.json();O(l)}}catch(e){console.error("Error fetching events",e)}finally{M(!1)}};g.useEffect(()=>{T()},[d]);const I=g.useMemo(()=>{const e=d.getFullYear(),r=d.getMonth(),n=new Date(e,r,1),c=new Date(n);c.setDate(c.getDate()-n.getDay());const o=[];for(let l=0;l<42;l++){const u=new Date(c);u.setDate(c.getDate()+l),o.push(u)}return o},[d]),J=e=>{const r=e.toISOString().split("T")[0];return v.filter(n=>n.event_date===r)},S=e=>F(new Date(d.getFullYear(),d.getMonth()+e,1)),R=e=>{e.getMonth()===d.getMonth()&&(_(!1),y(!1),i({event_date:e.toISOString().split("T")[0],recurrence:{type:"weekly",interval:1,endType:"never"}}),j(!0))},E=async e=>{if(_(!0),y(!!e.is_recurring),e.is_recurring_instance&&e.parent_event_id)try{const r=await w.get(`/calendar/${e.parent_event_id}`);if(r.ok){const n=await r.json();i({...e,recurrence:{type:n.recurrence_type||"weekly",interval:n.recurrence_interval||1,daysOfWeek:n.recurrence_days_of_week?JSON.parse(n.recurrence_days_of_week):void 0,dayOfMonth:n.recurrence_day_of_month,weekOfMonth:n.recurrence_week_of_month,dayOfWeek:n.recurrence_day_of_week,months:n.recurrence_months?JSON.parse(n.recurrence_months):void 0,endType:n.recurrence_end_type||"never",endDate:n.recurrence_end_date,occurrences:n.recurrence_occurrences,exceptions:n.recurrence_exceptions?JSON.parse(n.recurrence_exceptions):[]}})}else i({...e,recurrence:{type:"weekly",interval:1,endType:"never"}})}catch{i({...e,recurrence:{type:"weekly",interval:1,endType:"never"}})}else e.is_recurring?i({...e,recurrence:{type:e.recurrence_type||"weekly",interval:e.recurrence_interval||1,daysOfWeek:e.recurrence_days_of_week?JSON.parse(e.recurrence_days_of_week):void 0,dayOfMonth:e.recurrence_day_of_month,weekOfMonth:e.recurrence_week_of_month,dayOfWeek:e.recurrence_day_of_week,months:e.recurrence_months?JSON.parse(e.recurrence_months):void 0,endType:e.recurrence_end_type||"never",endDate:e.recurrence_end_date,occurrences:e.recurrence_occurrences,exceptions:e.recurrence_exceptions?JSON.parse(e.recurrence_exceptions):[]}}):i({...e,recurrence:{type:"weekly",interval:1,endType:"never"}});j(!0)},Y=async()=>{if(!s)return;const e=typeof s.id=="string"&&s.id.includes("_");let r=s.id;e&&(r=s.parent_event_id);const n=m?`/calendar/${r}`:"/calendar",c=m?"PUT":"POST",o={...s,is_recurring:m&&(s.is_recurring||s.is_recurring_instance)||h,recurrence:m&&(s.is_recurring||s.is_recurring_instance)||h?s.recurrence:void 0,update_series:(s==null?void 0:s.update_series)||!1,original_instance_date:e?s.id.split("_")[1]:void 0};(await w[c.toLowerCase()](n,o)).ok&&(await T(),j(!1),i(null),_(!1),y(!1))},L=async e=>{const r=typeof e=="string"&&e.includes("_"),n=(s==null?void 0:s.is_recurring)||(s==null?void 0:s.is_recurring_instance);let c=!1;if(r||n)if(s!=null&&s.update_series)c=!0;else{const u=window.confirm(`This is a recurring event.

OK = Just this instance
Cancel = Delete the entire series`);if(c=!u,u===null)return}else if(!window.confirm("Are you sure you want to delete this event?"))return;const o=r?e.split("_")[0]:e;(await w.request("DELETE",`/calendar/${o}`,{delete_series:c,exception_date:r&&!c?e.split("_")[1]:void 0})).ok&&(await T(),j(!1),i(null),_(!1),y(!1))};if(f)return t.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:t.jsx(H,{size:96})});const P=["January","February","March","April","May","June","July","August","September","October","November","December"];return t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/10",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Team Calendar"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Manage team events, competitions, and meetings"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>S(-1),className:"p-2 rounded-md hover:bg-white/5",children:"◀"}),t.jsxs("div",{className:"text-gray-300",children:[P[d.getMonth()]," ",d.getFullYear()]}),t.jsx("button",{onClick:()=>S(1),className:"p-2 rounded-md hover:bg-white/5",children:"▶"})]})]}),t.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[t.jsx("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:t.jsxs("div",{className:"grid grid-cols-7 gap-px bg-white/10",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>t.jsx("div",{className:"bg-black px-3 py-2 text-center text-xs font-medium text-gray-400 uppercase",children:e},e)),I.map((e,r)=>{const n=e.getMonth()===d.getMonth(),c=e.toDateString()===new Date().toDateString(),o=J(e);return t.jsxs("div",{className:`bg-black px-3 py-2 text-sm min-h-[110px] cursor-pointer hover:bg-white/5 ${n?"text-gray-100":"text-gray-500"} ${c?"ring-1 ring-sca-purple/60":""}`,onClick:()=>R(e),children:[t.jsx("div",{className:`font-medium ${c?"text-sca-gold":""}`,children:e.getDate()}),t.jsxs("div",{className:"mt-1 space-y-1",children:[o.slice(0,3).map(l=>t.jsxs("div",{className:`text-xs p-1 rounded truncate cursor-pointer transition-colors ${l.is_recurring||l.is_recurring_instance,"bg-sca-purple/25 text-sca-gold hover:bg-sca-purple/40"}`,onClick:u=>{u.stopPropagation(),E(l)},children:[t.jsxs("div",{className:"flex items-center gap-1",children:[(l.is_recurring||l.is_recurring_instance)&&t.jsx("span",{children:"⟳"}),t.jsx("span",{className:"truncate",children:l.title})]}),l.event_time&&t.jsxs("div",{className:"text-xs opacity-75 mt-0.5",children:[k(l.event_time),l.event_end_time&&` - ${k(l.event_end_time)}`]})]},l.id)),o.length>3&&t.jsxs("div",{className:"text-xs text-gray-500",children:["+",o.length-3," more"]})]})]},r)})]})}),t.jsxs("div",{className:"mt-6 border border-white/10 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-white/10",children:t.jsx("h3",{className:"text-lg font-medium",children:"Upcoming Events"})}),t.jsxs("div",{className:"divide-y divide-white/10",children:[v.filter(e=>new Date(e.event_date)>=new Date).sort((e,r)=>new Date(e.event_date).getTime()-new Date(r.event_date).getTime()).slice(0,5).map(e=>t.jsxs("div",{className:"px-6 py-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-sm font-medium",children:e.title}),e.is_recurring&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-sca-purple/30 text-sca-gold",children:"Recurring"}),e.is_recurring_instance&&t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-sca-purple/20 text-sca-gold",children:"Instance"})]}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:e.description}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[new Date(e.event_date).toLocaleDateString(),e.event_time&&` at ${k(e.event_time)}`,e.event_end_time&&` - ${k(e.event_end_time)}`,e.location&&` • ${e.location}`]})]}),t.jsx("button",{onClick:()=>E(e),className:"text-sca-gold hover:text-white text-sm",children:"Edit"})]},e.id)),v.filter(e=>new Date(e.event_date)>=new Date).length===0&&t.jsx("div",{className:"px-6 py-8 text-center text-gray-400",children:"No upcoming events"})]})]})]}),D&&s&&t.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:t.jsxs("div",{className:"relative p-8 bg-black w-full max-w-2xl m-auto rounded-lg shadow-lg border border-white/10 max-h-[90vh] overflow-y-auto",children:[t.jsxs("h3",{className:"text-lg font-medium mb-6",children:[m?"Edit Event":"Add New Event",s.is_recurring_instance&&t.jsx("span",{className:"ml-2 text-sm text-sca-gold",children:"(Recurring Event)"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Title"}),t.jsx("input",{type:"text",value:s.title||"",onChange:e=>i({...s,title:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),t.jsx("textarea",{value:s.description||"",onChange:e=>i({...s,description:e.target.value}),rows:3,className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Date"}),t.jsx("input",{type:"date",value:s.event_date||"",onChange:e=>i({...s,event_date:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Time"}),t.jsx("input",{type:"time",value:s.event_time||"",onChange:e=>i({...s,event_time:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"End Time (Optional)"}),t.jsx("input",{type:"time",value:s.event_end_time||"",onChange:e=>i({...s,event_end_time:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Location"}),t.jsx("input",{type:"text",value:s.location||"",onChange:e=>i({...s,location:e.target.value}),className:"w-full bg-gray-800 border border-gray-600 text-gray-100 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sca-purple"})]}),t.jsxs("div",{className:"space-y-4",children:[!m&&t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:h,onChange:e=>y(e.target.checked),className:"rounded border-gray-600 text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{className:"text-gray-300",children:"Make this a recurring event"})]}),m&&(s.is_recurring||s.is_recurring_instance)&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-gray-300",children:s.is_recurring_instance?"Part of recurring series":"Recurring event"}),t.jsxs("button",{type:"button",onClick:()=>y(!h),className:"text-sm text-sca-gold hover:text-white",children:[h?"Hide":"Edit"," recurrence settings"]})]}),s.is_recurring_instance&&t.jsxs("div",{className:"text-sm text-gray-400 bg-gray-800 p-3 rounded border border-gray-600",children:[t.jsx("p",{className:"mb-2",children:"You're editing a single occurrence of a recurring event."}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:s.update_series||!1,onChange:e=>i({...s,update_series:e.target.checked}),className:"rounded border-gray-600 text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{children:"Apply changes to entire series"})]})]})]}),m&&!s.is_recurring&&!s.is_recurring_instance&&t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:h,onChange:e=>y(e.target.checked),className:"rounded border-gray-600 text-sca-purple focus:ring-sca-purple"}),t.jsx("span",{className:"text-gray-300",children:"Make this a recurring event"})]})]}),h&&s.recurrence&&t.jsxs("div",{className:"border border-gray-600 rounded-lg p-4",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-200 mb-4",children:"Recurrence Settings"}),t.jsx(A,{recurrence:s.recurrence,onChange:e=>i({...s,recurrence:e}),eventDate:s.event_date||""})]})]}),t.jsxs("div",{className:"mt-8 flex justify-between",children:[t.jsx("div",{children:m&&(b==null?void 0:b.isAdmin)&&t.jsx("button",{onClick:()=>L(s.id),className:"px-4 py-2 text-sm font-medium text-red-400 hover:text-red-300",children:"Delete"})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{j(!1),i(null),_(!1),y(!1)},className:"px-4 py-2 text-sm font-medium text-gray-300 hover:text-white",children:"Cancel"}),t.jsx("button",{onClick:Y,className:"px-4 py-2 text-sm font-medium text-black bg-sca-gold hover:bg-yellow-400 rounded",children:m?"Save Changes":"Create Event"})]})]})]})})]})}export{G as default};
